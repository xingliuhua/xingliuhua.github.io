<!DOCTYPE html>
<html lang="zh-CN">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="robots" content="noodp" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1">
        <title>golang包管理 - xingliuhua博客</title><meta name="Description" content="golang包管理"><meta property="og:title" content="golang包管理" />
<meta property="og:description" content="golang包管理" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://xingliuhua.github.io/posts/go_package_manage/" />
<meta property="og:image" content="https://xingliuhua.github.io/logo.png"/>
<meta property="article:published_time" content="2017-03-10T17:55:28+08:00" />
<meta property="article:modified_time" content="2017-03-10T17:55:28+08:00" />
<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://xingliuhua.github.io/logo.png"/>

<meta name="twitter:title" content="golang包管理"/>
<meta name="twitter:description" content="golang包管理"/>
<meta name="application-name" content="xingliuhua博客">
<meta name="apple-mobile-web-app-title" content="xingliuhua博客"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
        <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="manifest" href="/site.webmanifest"><link rel="canonical" href="https://xingliuhua.github.io/posts/go_package_manage/" /><link rel="prev" href="https://xingliuhua.github.io/posts/go_context/" /><link rel="next" href="https://xingliuhua.github.io/posts/redis_go/" /><link rel="stylesheet" href="/lib/normalize/normalize.min.css"><link rel="stylesheet" href="/css/style.min.css"><link rel="stylesheet" href="/lib/fontawesome-free/all.min.css"><link rel="stylesheet" href="/lib/animate/animate.min.css"><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "golang包管理",
        "inLanguage": "zh-CN",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "https:\/\/xingliuhua.github.io\/posts\/go_package_manage\/"
        },"genre": "posts","keywords": "golang","wordcount":  2564 ,
        "url": "https:\/\/xingliuhua.github.io\/posts\/go_package_manage\/","datePublished": "2017-03-10T17:55:28+08:00","dateModified": "2017-03-10T17:55:28+08:00","publisher": {
            "@type": "Organization",
            "name": "xingliuhua"},"author": {
                "@type": "Person",
                "name": "xingliuhua"
            },"description": "golang包管理"
    }
    </script></head>
    <body header-desktop="fixed" header-mobile="auto"><script type="text/javascript">(window.localStorage && localStorage.getItem('theme') ? localStorage.getItem('theme') === 'dark' : ('auto' === 'auto' ? window.matchMedia('(prefers-color-scheme: dark)').matches : 'auto' === 'dark')) && document.body.setAttribute('theme', 'dark');</script>

        <div id="mask"></div><div class="wrapper"><header class="desktop" id="header-desktop">
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/" title="xingliuhua博客"><img
        class="lazyload logo"
        src="/svg/loading.min.svg"
        data-src="/logo.png"
        data-srcset="/logo.png, /logo.png 1.5x, /logo.png 2x"
        data-sizes="auto"
        alt="/logo.png"
        title="/logo.png" />xingliuhua</a>
        </div>
        <div class="menu">
            <div class="menu-inner"><a class="menu-item" href="/posts/"> 文章 </a><a class="menu-item" href="/tags/"> 标签 </a><a class="menu-item" href="/categories/"> 分类 </a><span class="menu-item delimiter"></span><span class="menu-item search" id="search-desktop">
                        <input type="text" placeholder="搜索文章标题或内容..." id="search-input-desktop">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-desktop" title="搜索">
                            <i class="fas fa-search fa-fw"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-desktop" title="清空">
                            <i class="fas fa-times-circle fa-fw"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-desktop">
                            <i class="fas fa-spinner fa-fw fa-spin"></i>
                        </span>
                    </span><a href="javascript:void(0);" class="menu-item theme-switch" title="切换主题">
                    <i class="fas fa-adjust fa-fw"></i>
                </a>
            </div>
        </div>
    </div>
</header><header class="mobile" id="header-mobile">
    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/" title="xingliuhua博客"><img
        class="lazyload logo"
        src="/svg/loading.min.svg"
        data-src="/logo.png"
        data-srcset="/logo.png, /logo.png 1.5x, /logo.png 2x"
        data-sizes="auto"
        alt="/logo.png"
        title="/logo.png" />xingliuhua</a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><div class="search-wrapper">
                    <div class="search mobile" id="search-mobile">
                        <input type="text" placeholder="搜索文章标题或内容..." id="search-input-mobile">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-mobile" title="搜索">
                            <i class="fas fa-search fa-fw"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-mobile" title="清空">
                            <i class="fas fa-times-circle fa-fw"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-mobile">
                            <i class="fas fa-spinner fa-fw fa-spin"></i>
                        </span>
                    </div>
                    <a href="javascript:void(0);" class="search-cancel" id="search-cancel-mobile">
                        取消
                    </a>
                </div><a class="menu-item" href="/posts/" title="">文章</a><a class="menu-item" href="/tags/" title="">标签</a><a class="menu-item" href="/categories/" title="">分类</a><a href="javascript:void(0);" class="menu-item theme-switch" title="切换主题">
                <i class="fas fa-adjust fa-fw"></i>
            </a></div>
    </div>
</header>
<div class="search-dropdown desktop">
    <div id="search-dropdown-desktop"></div>
</div>
<div class="search-dropdown mobile">
    <div id="search-dropdown-mobile"></div>
</div>
<main class="main">
                <div class="container"><div class="toc" id="toc-auto">
            <h2 class="toc-title">目录</h2>
            <div class="toc-content" id="toc-content-auto"></div>
        </div><article class="page single"><h1 class="single-title animated flipInX">golang包管理</h1><div class="post-meta">
            <div class="post-meta-line"><span class="post-author"><a href="https://xingliuhua/github.com.io" title="Author" target="_blank" rel="noopener noreffer author" class="author"><i class="fas fa-user-circle fa-fw"></i>xingliuhua</a></span>&nbsp;<span class="post-category">收录于 <a href="/categories/%E7%AC%94%E8%AE%B0/"><i class="far fa-folder fa-fw"></i>笔记</a></span></div>
            <div class="post-meta-line"><i class="far fa-calendar-alt fa-fw"></i>&nbsp;<time datetime="2017-03-10">2017-03-10</time>&nbsp;<i class="fas fa-pencil-alt fa-fw"></i>&nbsp;约 2564 字&nbsp;
                <i class="far fa-clock fa-fw"></i>&nbsp;预计阅读 6 分钟&nbsp;</div>
        </div><div class="details toc" id="toc-static"  kept="">
                <div class="details-summary toc-title">
                    <span>目录</span>
                    <span><i class="details-icon fas fa-angle-right"></i></span>
                </div>
                <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ol>
    <li><a href="#什么是vendor">什么是vendor</a></li>
    <li><a href="#为什么要引入vendor">为什么要引入vendor</a></li>
    <li><a href="#dep的使用">dep的使用</a>
      <ol>
        <li><a href="#安装dep">安装dep:</a></li>
        <li><a href="#dep命令">dep命令：</a></li>
      </ol>
    </li>
    <li><a href="#gomod">gomod</a>
      <ol>
        <li><a href="#gomod初始化">gomod初始化</a></li>
        <li><a href="#依赖包添加">依赖包添加</a></li>
        <li><a href="#依赖包的修改">依赖包的修改</a>
          <ol>
            <li>
              <ol>
                <li><a href="#删除依赖">删除依赖</a></li>
              </ol>
            </li>
          </ol>
        </li>
      </ol>
    </li>
    <li><a href="#goproxy">goproxy</a>
      <ol>
        <li><a href="#在-go-113-中如何使用-goproxycn">在 Go 1.13 中如何使用 goproxy.cn？</a></li>
        <li><a href="#在-go-113-之前如何使用-goproxycn">在 Go 1.13 之前如何使用 goproxy.cn？</a></li>
        <li><a href="#goprivate">GOPRIVATE</a></li>
      </ol>
    </li>
  </ol>
</nav></div>
            </div><div class="content" id="content"><h1 id="什么是vendor">什么是vendor</h1>
<p>go vendor 是go 1.5 官方引入管理包依赖的方式，1.6正式引入。其基本思路是，将引用的外部包的源代码放在当前工程的vendor目录下面，go 1.6以后编译go代码会优先从vendor目录先寻找依赖包。<br>
在Go 1.6之前，你需要手动的设置环境变量GO15VENDOREXPERIMENT=1才可以使Go找到Vendor目录，然而在Go 1.6之后，这个功能已经不需要配置环境变量就可以实现了。<br>
引入vendor机制后查找依赖包路径的解决方案如下：</p>
<ol>
<li>当前包下的vendor目录。</li>
<li>向上级目录查找，直到找到src下的vendor目录。</li>
<li>在GOPATH下面查找依赖包。</li>
<li>在GOROOT目录下查找。</li>
</ol>
<h1 id="为什么要引入vendor">为什么要引入vendor</h1>
<p>golang通过go get命令获取的代码是在gopath/src下的，如果我们有多个项目都引用同一个package就会出现一些问题，比如：项目迁移或新同事加入时，多次go get引入的package版本不一致，导致项目编译不通过。</p>
<h1 id="dep的使用">dep的使用</h1>
<p>vendor 机制虽然解决了上面的一些问题，但是无法精确的引用外部包进行版本控制，不能指定引用某个特定版本的外部包；只是在开发时，将其拷贝过来，但是一旦外部包升级,vendor下的代码不会跟着升级，而且vendor下面并没有文件记录引用包的版本信息。<br>
目前为止，golang官方并没有指定的工具，一些第三方开源帮我们解决这个问题。比如：govendor、glide、godep，dep等。dep和godep其实作者是同一人，只不过dep是golang官方非正式版。</p>
<blockquote>
<p>dep is a prototype dependency management tool for Go. It requires Go 1.9 or newer to compile. dep is safe for production use.<br>
dep is the official experiment, but not yet the official tool.
这是dep官网上的简介，它要求至少1.9的版本。</p>
</blockquote>
<h2 id="安装dep">安装dep:</h2>
<p>go get -u github.com/golang/dep/cmd/dep</p>
<h2 id="dep命令">dep命令：</h2>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"> <span class="n">dep</span> <span class="n">init</span>   <span class="n">set</span> <span class="n">up</span> <span class="n">a</span> <span class="k">new</span> <span class="n">project</span>
 <span class="n">dep</span> <span class="n">ensure</span> <span class="n">install</span> <span class="n">the</span> <span class="n">project</span><span class="err">&#39;</span><span class="n">s</span> <span class="n">dependencies</span>
 <span class="n">dep</span> <span class="n">ensure</span> <span class="o">-</span><span class="n">update</span> <span class="n">update</span> <span class="n">the</span> <span class="n">locked</span> <span class="n">versions</span> <span class="n">of</span> <span class="n">all</span> <span class="n">dependencies</span>
 <span class="n">dep</span> <span class="n">ensure</span> <span class="o">-</span><span class="n">add</span> <span class="n">github</span><span class="o">.</span><span class="na">com</span><span class="o">/</span><span class="n">pkg</span><span class="o">/</span><span class="n">errors</span>  <span class="n">add</span> <span class="n">a</span> <span class="n">dependency</span> <span class="n">to</span> <span class="n">the</span> <span class="n">project</span>
</code></pre></div><p>执行init命令后，项目根目录中新增了Gopkg.lock、Gopkg.toml和一个目录vendor。<br>
Gopkg.toml可以灵活地描述用户的意图，包括依赖的 source、branch、version等。Gopkg.lock仅仅描述依赖的具体状态，例如各依赖的revision。Gopkg.toml可以通过命令生产，也可以被用户根据 需要手动修改，Gopkg.lock是自动生成的，不可以修改。<br>
要想添加新的依赖可以使用命令<br>
dep ensure -add github.com/bitly/go-simplejson@=0.4.3<br>
也可以在代码中import，然后dep ensure命令即可。</p>
<h1 id="gomod">gomod</h1>
<p>另外使用 vendor 后，每个项目都完整拷贝一份依赖包，既不方便管理又浪费了本地空间。</p>
<p>此外，Go 项目中的 import 指令后面的 package 路径与项目代码的存放路径相关，项目目录不能随意移动，必须安分守己地趴在 $GOPATH/src 中，否则 import 会找不到项目中的 package，虽然可以通过在容器中编译或者为每个项目准备一套 Go 环境的方式解决，但是麻烦且有额外开销。</p>
<p>Go1.11 和 Go1.12 引入的 Go Modules 机制，提供了统一的依赖包管理工具 go mod，依赖包统一下载在 GOPATH/pkg/mod 中进行集中管理，统一包后面有版本号，所以不会出现问题。
GO111MODULE 有三个值：off, on和auto（默认值）。</p>
<p>GO111MODULE=off，go命令行将不会支持module功能，寻找依赖包的方式将会沿用旧版本那种通过vendor目录或者GOPATH模式来查找。
GO111MODULE=on，go命令行会使用modules，而一点也不会去GOPATH目录下查找。
GO111MODULE=auto，默认值，go命令行将会根据当前目录来决定是否启用module功能。这种情况下可以分为两种情形：</p>
<ul>
<li>当前目录在GOPATH/src之外且该目录包含go.mod文件</li>
<li>当前文件在包含go.mod文件的目录下面。</li>
</ul>
<p>gomod 依赖包下载存放目录在GOPATH/pkg/mod</p>
<p>Go Modules 将成为 Go1.13 默认的依赖包管理方法，在 Go1.11 和 Go1.12 中， Go Modules 只能在 $GOPATH 外部使用。</p>
<h2 id="gomod初始化">gomod初始化</h2>
<p>在 GOPATH 外部创建一个目录，然后初始化，项目的路径设置为 exampe.com/hello：</p>
<div class="highlight"><pre class="chroma"><code class="language-tex" data-lang="tex">go mod init example.com/hello        # 该项目代码的引用路径是 example.com/hello
</code></pre></div><p>增加了 go.mod 和 go.sum 文件。
go.mod 提供了module, require、replace和exclude 四个命令</p>
<p>module 语句指定包的名字（路径）
require 语句指定的依赖项模块
replace 语句可以替换依赖项模块
exclude 语句可以忽略依赖项模块</p>
<h2 id="依赖包添加">依赖包添加</h2>
<ol>
<li>我们可以直接在代码中import包，然后go build时就会自动更新go.mod文件。这个时候下载的是最新的版本。</li>
<li>go get命令会下载指定版本，并更新到go.mod，不过它是indirect，因为它还没有用到。</li>
</ol>
<div class="highlight"><pre class="chroma"><code class="language-tex" data-lang="tex">go get github.com/lijiaocn/glib@v0.0.2
</code></pre></div><h2 id="依赖包的修改">依赖包的修改</h2>
<p>依赖代码的版本更新很简单，直接用 go get 获取指定版本的依赖代码即可。</p>
<h4 id="删除依赖">删除依赖</h4>
<p>不需要的依赖必须手动清除，执行 go mod tidy，清除所有未使用的依赖。</p>
<h1 id="goproxy">goproxy</h1>
<p>默认情况下，go 命令直接从 VCS 下载模块。GOPROXY 环境变量允许进一步控制下载源。环境变量将 go 命令配置为使用 Go 模 块代理。</p>
<ul>
<li>不怕依赖的库被作者删除了。</li>
<li>您不再需要任何 VSC 工具来下载依赖项，因为依赖项是通过 HTTP 提供的 (Go 代理在后台使用 HTTP)。</li>
<li>下载和构建 Go 模块的速度明显加快，因为 Go 代理通过 HTTP 分别提供了源代码 ( .zip 存档) 和 go.mod。与从 VCS 进行提取相比，这导致下载花费更少的时间和更快的时间 (由于更少的开销)。</li>
<li>国内不用梯子了。</li>
</ul>
<h2 id="在-go-113-中如何使用-goproxycn">在 Go 1.13 中如何使用 goproxy.cn？</h2>
<p>答：一条 go env -w GOPROXY=https://goproxy.cn,direct 即可。之所以在后面拼接一个 ,direct，是因为通过这样做我们可以在一定程度上解决私有库的问题（当然， goproxy.cn 无法访问你的私有库）。这个 GOPROXY 设定的工作原理是：当 go 在抓取目标模块时，若遇见了 404 错误，那么就回退到 direct 也就是直接去目标模块的源头（比如 GitHub） 去抓取。而恰好，GitHub 等类似的代码托管网站的原则基本都是“你无权访问的你来说就是不存在的”，所以我才说通过这样设定可以在一定程度上解决私有库无法通过模块代理访问的问题。</p>
<h2 id="在-go-113-之前如何使用-goproxycn">在 Go 1.13 之前如何使用 goproxy.cn？</h2>
<p>答：同样也是设置环境变量即可，但是得你手动配置，而且还不能使用上述的那个 ,direct 后缀，因为那是 Go 1.13 刚加的特性。详细配置方法可以参见 goproxy.cn 的 README 文件。</p>
<h2 id="goprivate">GOPRIVATE</h2>
<p>前面也说到对于一些内部的 package，GoProxy 并不能很好的处理，Go 1.13 推出了 GOPRIVATE 机制。只需要设置这个环境变量，然后标识出哪些 package 是 private 的，那么对于这个 package 的处理将不会从 proxy 下载。GOPRIVATE 的值是一个以逗号分隔的列表，支持正则（正则语法遵守 Golang 的 包 path.Match）
GOPRIVATE=*.corp.example.com,rsc.io/private</p>
</div><div class="post-footer" id="post-footer">
    <div class="post-info">
        <div class="post-info-line">
            <div class="post-info-mod">
                <span>更新于 2017-03-10</span>
            </div>
            <div class="post-info-license"></div>
        </div>
        <div class="post-info-line">
            <div class="post-info-md"></div>
            <div class="post-info-share">
                <span></span>
            </div>
        </div>
    </div>

    <div class="post-info-more">
        <section class="post-tags"><i class="fas fa-tags fa-fw"></i>&nbsp;<a href="/tags/golang/">golang</a></section>
        <section>
            <span><a href="javascript:void(0);" onclick="window.history.back();">返回</a></span>&nbsp;|&nbsp;<span><a href="/">主页</a></span>
        </section>
    </div>

    <div class="post-nav"><a href="/posts/go_context/" class="prev" rel="prev" title="context"><i class="fas fa-angle-left fa-fw"></i>context</a>
            <a href="/posts/redis_go/" class="next" rel="next" title="Redis学习（四）-golang使用redis">Redis学习（四）-golang使用redis<i class="fas fa-angle-right fa-fw"></i></a></div>
</div>
<div id="comments"><div id="gitalk" class="comment"></div><noscript>
                Please enable JavaScript to view the comments powered by <a href="https://github.com/gitalk/gitalk"></a>Gitalk</a>.
            </noscript></div></article></div>
            </main><footer class="footer">
        <div class="footer-container"><div class="footer-line">由 <a href="https://gohugo.io/" target="_blank" rel="noopener noreffer" title="Hugo 0.73.0">Hugo</a> 强力驱动 | 主题 - <a href="https://github.com/dillonzq/LoveIt" target="_blank" rel="noopener noreffer" title="LoveIt 0.2.10"><i class="far fa-kiss-wink-heart fa-fw"></i> LoveIt</a>
                </div><div class="footer-line"><i class="far fa-copyright fa-fw"></i><span itemprop="copyrightYear">2022</span><span class="author" itemprop="copyrightHolder">&nbsp;<a href="https://xingliuhua/github.com.io" target="_blank">xingliuhua</a></span></div>
        </div>
    </footer></div>

        <div id="fixed-buttons"><a href="#" id="back-to-top" class="fixed-button" title="回到顶部">
                <i class="fas fa-arrow-up fa-fw"></i>
            </a><a href="#" id="view-comments" class="fixed-button" title="查看评论">
                <i class="fas fa-comment fa-fw"></i>
            </a>
        </div><link rel="stylesheet" href="/lib/gitalk/gitalk.min.css"><link rel="stylesheet" href="/lib/lightgallery/lightgallery.min.css"><script type="text/javascript" src="/lib/gitalk/gitalk.min.js"></script><script type="text/javascript" src="/lib/smooth-scroll/smooth-scroll.min.js"></script><script type="text/javascript" src="/lib/autocomplete/autocomplete.min.js"></script><script type="text/javascript" src="/lib/lunr/lunr.min.js"></script><script type="text/javascript" src="/lib/lunr/lunr.stemmer.support.min.js"></script><script type="text/javascript" src="/lib/lunr/lunr.zh.min.js"></script><script type="text/javascript" src="/lib/lazysizes/lazysizes.min.js"></script><script type="text/javascript" src="/lib/lightgallery/lightgallery.min.js"></script><script type="text/javascript" src="/lib/lightgallery/lg-thumbnail.min.js"></script><script type="text/javascript" src="/lib/lightgallery/lg-zoom.min.js"></script><script type="text/javascript" src="/lib/clipboard/clipboard.min.js"></script><script type="text/javascript">window.config={"code":{"copyTitle":"复制到剪贴板","maxShownLines":15},"comment":{"gitalk":{"admin":["xingliuhua"],"clientID":"c0161bf1d93ccdd5f765","clientSecret":"3782f9a39ee0849148faa2ec75bb19d9964dda16","id":"2017-03-10T17:55:28+08:00","owner":"xingliuhua","repo":"xingliuhua.github.io","title":"golang包管理"}},"lightGallery":{"actualSize":false,"exThumbImage":"data-thumbnail","hideBarsDelay":2000,"selector":".lightgallery","speed":400,"thumbContHeight":80,"thumbWidth":80,"thumbnail":true},"search":{"highlightTag":"em","lunrIndexURL":"/index.json","lunrLanguageCode":"zh","lunrSegmentitURL":"/lib/lunr/lunr.segmentit.js","maxResultLength":10,"noResultsFound":"没有找到结果","snippetLength":50,"type":"lunr"}};</script><script type="text/javascript" src="/js/theme.min.js"></script></body>
</html>
