<!DOCTYPE html>
<html lang="zh-CN">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="robots" content="noodp" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1">
        <title>android加载html - xingliuhua博客</title><meta name="Description" content="android加载html"><meta property="og:title" content="android加载html" />
<meta property="og:description" content="android加载html" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://xingliuhua.github.io/posts/android_%E5%8A%A0%E8%BD%BDhtml/" />
<meta property="og:image" content="https://xingliuhua.github.io/logo.png"/>
<meta property="article:published_time" content="2020-04-08T17:55:28+08:00" />
<meta property="article:modified_time" content="2020-04-08T17:55:28+08:00" />
<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://xingliuhua.github.io/logo.png"/>

<meta name="twitter:title" content="android加载html"/>
<meta name="twitter:description" content="android加载html"/>
<meta name="application-name" content="xingliuhua博客">
<meta name="apple-mobile-web-app-title" content="xingliuhua博客"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
        <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="manifest" href="/site.webmanifest"><link rel="canonical" href="https://xingliuhua.github.io/posts/android_%E5%8A%A0%E8%BD%BDhtml/" /><link rel="prev" href="https://xingliuhua.github.io/posts/android_%E5%9B%BE%E7%89%87%E5%8A%A0%E8%BD%BD/" /><link rel="next" href="https://xingliuhua.github.io/posts/android_glide/" /><link rel="stylesheet" href="/lib/normalize/normalize.min.css"><link rel="stylesheet" href="/css/style.min.css"><link rel="stylesheet" href="/lib/fontawesome-free/all.min.css"><link rel="stylesheet" href="/lib/animate/animate.min.css"><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "android加载html",
        "inLanguage": "zh-CN",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "https:\/\/xingliuhua.github.io\/posts\/android_%E5%8A%A0%E8%BD%BDhtml\/"
        },"genre": "posts","keywords": "android","wordcount":  3705 ,
        "url": "https:\/\/xingliuhua.github.io\/posts\/android_%E5%8A%A0%E8%BD%BDhtml\/","datePublished": "2020-04-08T17:55:28+08:00","dateModified": "2020-04-08T17:55:28+08:00","publisher": {
            "@type": "Organization",
            "name": "xingliuhua"},"author": {
                "@type": "Person",
                "name": "xingliuhua"
            },"description": "android加载html"
    }
    </script></head>
    <body header-desktop="fixed" header-mobile="auto"><script type="text/javascript">(window.localStorage && localStorage.getItem('theme') ? localStorage.getItem('theme') === 'dark' : ('auto' === 'auto' ? window.matchMedia('(prefers-color-scheme: dark)').matches : 'auto' === 'dark')) && document.body.setAttribute('theme', 'dark');</script>

        <div id="mask"></div><div class="wrapper"><header class="desktop" id="header-desktop">
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/" title="xingliuhua博客"><img
        class="lazyload logo"
        src="/svg/loading.min.svg"
        data-src="/logo.png"
        data-srcset="/logo.png, /logo.png 1.5x, /logo.png 2x"
        data-sizes="auto"
        alt="/logo.png"
        title="/logo.png" />xingliuhua</a>
        </div>
        <div class="menu">
            <div class="menu-inner"><a class="menu-item" href="/posts/"> 文章 </a><a class="menu-item" href="/tags/"> 标签 </a><a class="menu-item" href="/categories/"> 分类 </a><span class="menu-item delimiter"></span><span class="menu-item search" id="search-desktop">
                        <input type="text" placeholder="搜索文章标题或内容..." id="search-input-desktop">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-desktop" title="搜索">
                            <i class="fas fa-search fa-fw"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-desktop" title="清空">
                            <i class="fas fa-times-circle fa-fw"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-desktop">
                            <i class="fas fa-spinner fa-fw fa-spin"></i>
                        </span>
                    </span><a href="javascript:void(0);" class="menu-item theme-switch" title="切换主题">
                    <i class="fas fa-adjust fa-fw"></i>
                </a>
            </div>
        </div>
    </div>
</header><header class="mobile" id="header-mobile">
    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/" title="xingliuhua博客"><img
        class="lazyload logo"
        src="/svg/loading.min.svg"
        data-src="/logo.png"
        data-srcset="/logo.png, /logo.png 1.5x, /logo.png 2x"
        data-sizes="auto"
        alt="/logo.png"
        title="/logo.png" />xingliuhua</a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><div class="search-wrapper">
                    <div class="search mobile" id="search-mobile">
                        <input type="text" placeholder="搜索文章标题或内容..." id="search-input-mobile">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-mobile" title="搜索">
                            <i class="fas fa-search fa-fw"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-mobile" title="清空">
                            <i class="fas fa-times-circle fa-fw"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-mobile">
                            <i class="fas fa-spinner fa-fw fa-spin"></i>
                        </span>
                    </div>
                    <a href="javascript:void(0);" class="search-cancel" id="search-cancel-mobile">
                        取消
                    </a>
                </div><a class="menu-item" href="/posts/" title="">文章</a><a class="menu-item" href="/tags/" title="">标签</a><a class="menu-item" href="/categories/" title="">分类</a><a href="javascript:void(0);" class="menu-item theme-switch" title="切换主题">
                <i class="fas fa-adjust fa-fw"></i>
            </a></div>
    </div>
</header>
<div class="search-dropdown desktop">
    <div id="search-dropdown-desktop"></div>
</div>
<div class="search-dropdown mobile">
    <div id="search-dropdown-mobile"></div>
</div>
<main class="main">
                <div class="container"><div class="toc" id="toc-auto">
            <h2 class="toc-title">目录</h2>
            <div class="toc-content" id="toc-content-auto"></div>
        </div><article class="page single"><h1 class="single-title animated flipInX">android加载html</h1><div class="post-meta">
            <div class="post-meta-line"><span class="post-author"><a href="https://xingliuhua/github.com.io" title="Author" target="_blank" rel="noopener noreffer author" class="author"><i class="fas fa-user-circle fa-fw"></i>xingliuhua</a></span>&nbsp;<span class="post-category">收录于 <a href="/categories/%E7%AC%94%E8%AE%B0/"><i class="far fa-folder fa-fw"></i>笔记</a></span></div>
            <div class="post-meta-line"><i class="far fa-calendar-alt fa-fw"></i>&nbsp;<time datetime="2020-04-08">2020-04-08</time>&nbsp;<i class="fas fa-pencil-alt fa-fw"></i>&nbsp;约 3705 字&nbsp;
                <i class="far fa-clock fa-fw"></i>&nbsp;预计阅读 8 分钟&nbsp;</div>
        </div><div class="details toc" id="toc-static"  kept="">
                <div class="details-summary toc-title">
                    <span>目录</span>
                    <span><i class="details-icon fas fa-angle-right"></i></span>
                </div>
                <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ol>
    <li>
      <ol>
        <li>
          <ol>
            <li><a href="#android加载html">android加载html</a></li>
            <li><a href="#android调用js">android调⽤用js</a></li>
            <li><a href="#js调用android">js调⽤用android</a>
              <ol>
                <li><a href="#addjavascriptinterface方案">addJavascriptInterface⽅方案</a></li>
                <li><a href="#拦截url方案schema">拦截url⽅方案（schema）</a></li>
                <li><a href="#拦截对话框">拦截对话框</a></li>
              </ol>
            </li>
            <li><a href="#总结">总结</a>
              <ol>
                <li><a href="#android调用js-1">android调⽤用js</a></li>
                <li><a href="#js调用android-1">js调⽤用android</a></li>
                <li><a href="#项目中遇到的问题">项⽬目中遇到的问题</a></li>
              </ol>
            </li>
          </ol>
        </li>
      </ol>
    </li>
  </ol>
</nav></div>
            </div><div class="content" id="content"><h3 id="android加载html">android加载html</h3>
<p>Android中是通过webView控件来加载html⻚页⾯面的。在Android &lt; 4.4 （KitKat）上的WebView是基于
Webkit实现的，⽽而Android &gt;= 4.4 的WebView 则是基于Chrome for Android version 30实现的。
andorid代码示例例：
加载html，很简单，⼀一般我们还会设置WebViewClient，来进⾏行行更更复杂的操作。</p>
<ol>
<li>设置WebViewClient                                                                                                 <br>
除此之外，我们在WebViewClient的回调⽅方法⾥里里可以监听html的开始、结束等信息。</li>
</ol>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="n">mWebView</span><span class="o">.</span><span class="na">loadUrl</span><span class="o">(</span><span class="s">&#34;http://www.baidu.com&#34;</span>
<span class="n">mWebView</span><span class="o">.</span><span class="na">setWebViewClient</span><span class="o">(</span><span class="k">new</span> <span class="n">WebViewClient</span><span class="o">()</span> <span class="o">{</span>
        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">shouldOverrideUrlLoading</span><span class="o">(</span><span class="n">WebView</span> <span class="n">view</span><span class="o">,</span> <span class="n">String</span> <span class="n">url</span><span class="o">)</span> <span class="o">{</span>
                <span class="c1">//我们可以在这⾥里里拦截特定的rl请求，然后进⾏行行⾃自⼰己要的操作
</span><span class="c1"></span>                <span class="k">if</span> <span class="o">(</span><span class="n">url</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="s">&#34;http://www.baidu.com&#34;</span><span class="o">))</span> <span class="o">{</span>
                    <span class="n">Log</span><span class="o">.</span><span class="na">e</span><span class="o">(</span><span class="n">TAG</span><span class="o">,</span> <span class="s">&#34;shouldOverrideUrlLoading: &#34;</span> <span class="o">+</span> <span class="n">url</span><span class="o">);</span>
                    <span class="n">startActivity</span><span class="o">(</span><span class="k">new</span> 
<span class="n">Intent</span><span class="o">(</span><span class="n">MainActivity</span><span class="o">.</span><span class="na">this</span><span class="o">,</span><span class="n">Main2Activity</span><span class="o">.</span><span class="na">class</span><span class="o">));</span>
                    <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
                <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
                <span class="c1">//这⾥里里我们⾃自⼰己重新加载新的url⻚页⾯面，防⽌止点击链接跳转到系统浏览器器
</span><span class="c1"></span>                    <span class="n">mWebView</span><span class="o">.</span><span class="na">loadUrl</span><span class="o">(</span><span class="n">url</span><span class="o">);</span>
                    <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
                <span class="o">}</span>
            <span class="o">}</span>
        <span class="o">}</span>
    <span class="o">});</span>
</code></pre></div><ol start="2">
<li>设置WebChromeClient                                                                                           <br>
为webView控件指定WebChromeClient。</li>
</ol>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"> <span class="n">mWebView</span><span class="o">.</span><span class="na">setWebChromeClient</span><span class="o">(</span><span class="k">new</span> <span class="n">WebChromeClient</span><span class="o">()</span> <span class="o">{</span>
            
            <span class="nd">@Override</span>
            <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onProgressChanged</span><span class="o">(</span><span class="n">WebView</span> <span class="n">view</span><span class="o">,</span> <span class="kt">int</span> <span class="n">newProgress</span><span class="o">)</span> <span class="o">{</span>
            <span class="o">}</span>
        <span class="o">});</span>
</code></pre></div><p>WebChromeClient与webViewClient的区别 webViewClient处理理偏界⾯面的操作：打开新界⾯面，界⾯面打
开，界⾯面打开，界⾯面放⼤大，结束等。 WebChromeClient处理理偏js的操作。</p>
<ol start="3">
<li>webview基本设置</li>
</ol>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="n">WebSettings</span> <span class="n">webSettings</span> <span class="o">=</span> <span class="n">mWebView</span><span class="o">.</span><span class="na">getSettings</span><span class="o">();</span>
<span class="c1">//如果访问的⻚页⾯面中要与Javascript交互，则webview必须设置⽀支持Javascript
</span><span class="c1"></span><span class="n">webSettings</span><span class="o">.</span><span class="na">setJavaScriptEnabled</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>  
<span class="c1">// 若加载的 html ⾥里里有JS 在执⾏行行动画等操作，会造成资源浪费（CPU、电量量）
</span><span class="c1">// 在 onStop 和 onResume ⾥里里分别把 setJavaScriptEnabled() 给设置成 false 和 true 即
</span><span class="c1"></span><span class="n">可</span>
<span class="c1">//⽀支持插件
</span><span class="c1"></span><span class="n">webSettings</span><span class="o">.</span><span class="na">setPluginsEnabled</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span> 
<span class="c1">//设置⾃自适应屏幕，两者合⽤用
</span><span class="c1"></span><span class="n">webSettings</span><span class="o">.</span><span class="na">setUseWideViewPort</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span> <span class="c1">//将图⽚片调整到适合webview的⼤大⼩小 
</span><span class="c1"></span><span class="n">webSettings</span><span class="o">.</span><span class="na">setLoadWithOverviewMode</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span> <span class="c1">// 缩放⾄至屏幕的⼤大⼩小
</span><span class="c1">//缩放操作
</span><span class="c1"></span><span class="n">webSettings</span><span class="o">.</span><span class="na">setSupportZoom</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span> <span class="c1">//⽀支持缩放，默认为true。是下⾯面那个的前提。
</span><span class="c1"></span><span class="n">webSettings</span><span class="o">.</span><span class="na">setBuiltInZoomControls</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span> <span class="c1">//设置内置的缩放控件。若为false，则该
</span><span class="c1"></span><span class="n">WebView不不可缩放</span>
<span class="n">webSettings</span><span class="o">.</span><span class="na">setDisplayZoomControls</span><span class="o">(</span><span class="kc">false</span><span class="o">);</span> <span class="c1">//隐藏原⽣生的缩放控件
</span><span class="c1">//其他细节操作
</span><span class="c1"></span><span class="n">webSettings</span><span class="o">.</span><span class="na">setCacheMode</span><span class="o">(</span><span class="n">WebSettings</span><span class="o">.</span><span class="na">LOAD_CACHE_ELSE_NETWORK</span><span class="o">);</span> <span class="c1">//关闭webview中缓
</span><span class="c1"></span><span class="n">存</span> 
<span class="n">webSettings</span><span class="o">.</span><span class="na">setAllowFileAccess</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span> <span class="c1">//设置可以访问⽂文件 
</span><span class="c1"></span><span class="n">webSettings</span><span class="o">.</span><span class="na">setJavaScriptCanOpenWindowsAutomatically</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span> <span class="c1">//⽀支持通过JS打开新窗
</span><span class="c1"></span><span class="err">⼝</span><span class="n">口</span> 
<span class="n">webSettings</span><span class="o">.</span><span class="na">setLoadsImagesAutomatically</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span> <span class="c1">//⽀支持⾃自动加载图⽚片
</span><span class="c1"></span><span class="n">webSettings</span><span class="o">.</span><span class="na">setDefaultTextEncodingName</span><span class="o">(</span><span class="s">&#34;utf-8&#34;</span><span class="o">);</span><span class="c1">//设置编码格式
</span></code></pre></div><p>基本设置api根据实际需要来改动。</p>
<h3 id="android调用js">android调⽤用js</h3>
<p>android要想调⽤用js⼀一定要让webView⽀支持
有两种⽅方式：</p>
<ol>
<li>调⽤用的js⽅方法没有返回值，则直接可以调⽤用mWebView.loadUrl(&ldquo;javascript:do()&quot;);其中do是js中的
⽅方法；</li>
<li>有返回值时我们可以调⽤用mWebView.evaluateJavascript()⽅方法。
实例例代码：</li>
</ol>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="c1">//⾸首先设置Webview⽀支持JS代码
</span><span class="c1"></span><span class="n">webView</span><span class="o">.</span><span class="na">getSettings</span><span class="o">().</span><span class="na">setJavaScriptEnabled</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
<span class="nd">@TargetApi</span><span class="o">(</span><span class="n">Build</span><span class="o">.</span><span class="na">VERSION_CODES</span><span class="o">.</span><span class="na">KITKAT</span><span class="o">)</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onSum</span><span class="o">(</span><span class="n">View</span> <span class="n">view</span><span class="o">){</span>
      
<span class="n">webView</span><span class="o">.</span><span class="na">evaluateJavascript</span><span class="o">(</span><span class="s">&#34;sum(1,2)&#34;</span><span class="o">,</span> <span class="k">new</span> <span class="n">ValueCallback</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;()</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onReceiveValue</span><span class="o">(</span><span class="n">String</span> <span class="n">value</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Toast</span><span class="o">.</span><span class="na">makeText</span><span class="o">(</span><span class="n">getApplicationContext</span><span class="o">(),</span>
<span class="o">}</span> <span class="o">});</span>
<span class="o">}</span>
<span class="s">&#34;相加结果:&#34;</span><span class="o">+</span><span class="n">value</span><span class="o">,</span> <span class="n">Toast</span><span class="o">.</span><span class="na">LENGTH_SHORT</span><span class="o">).</span><span class="na">show</span><span class="o">();</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">onDoing</span><span class="o">(</span><span class="n">View</span> <span class="n">view</span><span class="o">){</span>
<span class="n">String</span> <span class="n">msg</span> <span class="o">=</span> <span class="s">&#34;测试&#34;</span><span class="o">;</span> <span class="n">webView</span><span class="o">.</span><span class="na">loadUrl</span><span class="o">(</span><span class="s">&#34;javascript:showInfoFromJava(&#39;&#34;</span><span class="o">+</span><span class="n">msg</span><span class="o">+</span><span class="s">&#34;&#39;)&#34;</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></div><p>对比：
优点：该⽅方法⽐比第⼀一种⽅方法效率更更⾼高、使⽤用更更简洁。
缺点：因为该⽅方法的执⾏行行不不会使⻚页⾯面刷新，⽽而第⼀一种⽅方法（loadUrl ）的执⾏行行则会。Android 4.4 后才可
使⽤用。（开发中第⼀一种较多）</p>
<h3 id="js调用android">js调⽤用android</h3>
<p>对于JS调⽤用Android代码的⽅方法有3种：</p>
<ol>
<li>通过WebView的addJavascriptInterface（）进⾏行行对象映射。</li>
<li>通过 WebViewClient 的shouldOverrideUrlLoading ()⽅方法回调拦截 url。</li>
<li>通过 WebChromeClient 的onJsAlert()、onJsConfirm()、onJsPrompt（）⽅方法回调拦截JS对话框
alert()、confirm()、prompt（） 消息。</li>
</ol>
<h4 id="addjavascriptinterface方案">addJavascriptInterface⽅方案</h4>
<p>通过webview的api注册本地⽅方法:</p>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kt">void</span> <span class="nf">addJavascriptInterface</span><span class="o">(</span><span class="n">Object</span> <span class="n">object</span><span class="o">,</span> <span class="n">String</span> <span class="n">name</span><span class="o">);</span>
</code></pre></div><p>js⽂文件实例例代码:</p>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"> 
<span class="n">function</span> <span class="nf">jsJava</span><span class="o">(){</span> <span class="c1">//调⽤用java的⽅方法，顶级对象，java⽅方法
</span><span class="c1">//可以直接访问JSTest，这是因为JSTest挂载到js的window对象下了了
</span><span class="c1"></span><span class="n">JSTest</span><span class="o">.</span><span class="na">showToast</span><span class="o">(</span><span class="s">&#34;我是被JS执⾏行行的Android代码&#34;</span><span class="o">);</span> <span class="o">}</span>
</code></pre></div><p>对应的Java代码:</p>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"> 
<span class="c1">//java与js回调，⾃自定义⽅方法 //1.java调⽤用js //2.js调⽤用java
</span><span class="c1"></span> 
<span class="c1">//⾸首先java暴暴露露接⼝口，供js调⽤用 /**
</span><span class="c1"></span><span class="o">*</span> <span class="n">obj</span><span class="o">:</span><span class="n">暴暴露露的要调</span><span class="err">⽤</span><span class="n">用的对象</span>
<span class="o">*</span> <span class="n">interfaceName</span><span class="o">:</span><span class="n">对象的映射名称</span> <span class="o">,</span><span class="n">object的对象名</span><span class="err">，</span><span class="n">在js中可以直接调</span><span class="err">⽤</span><span class="n">用</span> <span class="o">*</span> <span class="n">在html的js中</span><span class="o">:</span><span class="n">JSTest</span><span class="o">.</span><span class="na">showToast</span><span class="o">(</span><span class="n">msg</span><span class="o">)</span>
<span class="o">*</span> <span class="n">可以直接访问JSTest</span><span class="err">，</span><span class="n">这是因为JSTest挂载到js的window对象下了了</span>
<span class="o">*/</span>
<span class="n">webView</span><span class="o">.</span><span class="na">addJavascriptInterface</span><span class="o">(</span><span class="k">new</span> <span class="n">Object</span><span class="o">()</span> <span class="o">{</span> <span class="c1">//定义要调⽤用的⽅方法
</span><span class="c1">//msg由js调⽤用的时候传递 @JavascriptInterface
</span><span class="c1"></span><span class="kd">public</span> <span class="kt">void</span> <span class="nf">showToast</span><span class="o">(</span><span class="n">String</span> <span class="n">msg</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Toast</span><span class="o">.</span><span class="na">makeText</span><span class="o">(</span><span class="n">getApplicationContext</span><span class="o">(),</span>
                <span class="n">msg</span><span class="o">,</span> <span class="n">Toast</span><span class="o">.</span><span class="na">LENGTH_SHORT</span><span class="o">).</span><span class="na">show</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">},</span> <span class="s">&#34;JSTest&#34;</span><span class="o">);</span>
</code></pre></div><p>这样就实现了了js调⽤用android原⽣生的toast效果。 注意: 该⽅方案在部分操作系统版本中存在漏漏洞洞:</p>
<ul>
<li>Android API 16.0及之前的版本中存在安全漏漏洞洞，该漏漏洞洞源于程序没有正确限制使⽤用 WebView.addJavascriptInterface⽅方法。远程攻击者可通过使⽤用Java Reflection API利利⽤用该漏漏洞洞执 ⾏行行任意Java对象的⽅方法。API&lt;=16</li>
<li>java/android/webkit/BrowserFrame.java 使⽤用addJavascriptInterface API并创建了了 SearchBoxImpl类的对象。攻击者可通过访问searchBoxJavaBridge_接⼝口利利⽤用该漏漏洞洞执⾏行行任意Java 代码。API&lt;=4.3.1</li>
<li>所有由系统提供的WebView都会被加⼊入两个JS objects，分别为是accessibility和 accessibilityTraversal。恶意攻击者就可以使⽤用accessibility和accessibilityTraversal这两个Java Bridge来执⾏行行远程攻击代码. API&lt;4.4</li>
</ul>
<p>升级系统API level 17后，只有显示添加 @JavascriptInterface的⽅方法才能被JavaScript调⽤用，这样反射 就失去作⽤用了了。但对于更更低版本则还是会存在。</p>
<h4 id="拦截url方案schema">拦截url⽅方案（schema）</h4>
<p>具体原理理：</p>
<ol>
<li>Android通过 WebViewClient 的回调⽅方法 shouldOverrideUrlLoading ()拦截 url</li>
<li>解析该 url 的协议</li>
<li>如果检测到是预先约定好的协议，就调⽤用相应⽅方法</li>
</ol>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="n">mWebView</span><span class="o">.</span><span class="na">setWebViewClient</span><span class="o">(</span><span class="k">new</span> <span class="n">WebViewClient</span><span class="o">()</span> <span class="o">{</span>
            <span class="nd">@Override</span>
<span class="o">{</span>
<span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">shouldOverrideUrlLoading</span><span class="o">(</span><span class="n">WebView</span> <span class="n">view</span><span class="o">,</span> <span class="n">String</span> <span class="n">url</span><span class="o">)</span>
<span class="c1">// 步骤2:根据协议的参数，判断是否是所需要的url
</span><span class="c1">// ⼀一般根据scheme(协议格式) &amp; authority(协议名)判断(前两个参数)
</span><span class="c1"></span><span class="n">定好的需要拦截的</span><span class="o">)</span>
<span class="n">协议</span>
<span class="n">Uri</span> <span class="n">uri</span> <span class="o">=</span> <span class="n">Uri</span><span class="o">.</span><span class="na">parse</span><span class="o">(</span><span class="n">url</span><span class="o">);</span>
<span class="c1">// 如果url的协议 = 预先约定的 js 协议 // 就解析往下解析参数
</span><span class="c1"></span><span class="k">if</span> <span class="o">(</span><span class="n">uri</span><span class="o">.</span><span class="na">getScheme</span><span class="o">().</span><span class="na">equals</span><span class="o">(</span><span class="s">&#34;js&#34;</span><span class="o">))</span> <span class="o">{</span>
<span class="c1">// 如果 authority = 预先约定协议⾥里里的 webview，即代表都符合约定的 // 所以拦截url,下⾯面JS开始调⽤用Android需要的⽅方法
</span><span class="c1"></span>            <span class="k">if</span> <span class="o">(</span><span class="n">uri</span><span class="o">.</span><span class="na">getAuthority</span><span class="o">().</span><span class="na">equals</span><span class="o">(</span><span class="s">&#34;webview&#34;</span><span class="o">))</span> <span class="o">{</span>
<span class="c1">// 步骤3:
</span><span class="c1">// 执⾏行行JS所需要调⽤用的逻辑 System.out.println(&#34;js调⽤用了了Android的⽅方法&#34;);
</span><span class="c1">// 可以在协议上带有参数并传递到Android上
</span><span class="c1"></span><span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="n">params</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashMap</span><span class="o">&lt;&gt;();</span> <span class="n">Set</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">collection</span> <span class="o">=</span> <span class="n">uri</span><span class="o">.</span><span class="na">getQueryParameterNames</span><span class="o">();</span>
<span class="o">}</span>
            <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="kd">super</span><span class="o">.</span><span class="na">shouldOverrideUrlLoading</span><span class="o">(</span><span class="n">view</span><span class="o">,</span> <span class="n">url</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">});</span>
</code></pre></div><h4 id="拦截对话框">拦截对话框</h4>
<p>该开发中使⽤用不不多。 Android通过 WebChromeClient 的onJsAlert()、onJsConfirm()、
onJsPrompt（）⽅方法回调分别拦截JS对话框（即上述三个⽅方法），得到他们的消息内容，然后解析即
可。</p>
<h3 id="总结">总结</h3>
<h4 id="android调用js-1">android调⽤用js</h4>
<p>不不需要返回值：loadUrl()法 需要返回值：evaluateJavascript()⽅方法</p>
<h4 id="js调用android-1">js调⽤用android</h4>
<p>addJavascriptInterface⽅方案: 需要注册js⽅方法，使⽤用简单，但是有些安卓版本存在漏漏洞洞。
schema协议⽅方案: 兼容性好，⽐比较流⾏行行(JSBridge库就是利利⽤用该⽅方案进⾏行行封装)。但是接⼝口太多， android要对url进⾏行行⼤大量量的解析判断。</p>
<h4 id="项目中遇到的问题">项⽬目中遇到的问题</h4>
<p><strong>https加载问题</strong> 很多HTTPs⻚页⾯面加载不不出来的主要原因是SSL证书不不能被正确识别，所以我们这⾥里里要做的，就是重载
WebViewClient中的OnReceiveSslError⽅方法:</p>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"> 
<span class="cm">/**
</span><span class="cm"> * Description: handle https
</span><span class="cm"> * Created by Michael Lee on 12/6/16 08:38
</span><span class="cm"> */</span>
<span class="nd">@Override</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">onReceivedSslError</span><span class="o">(</span><span class="n">WebView</span> <span class="n">view</span><span class="o">,</span> <span class="n">SslErrorHandler</span> <span class="n">handler</span><span class="o">,</span> <span class="n">SslError</span>
<span class="n">error</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">handler</span><span class="o">.</span><span class="na">proceed</span><span class="o">();</span>
<span class="o">}</span>
</code></pre></div><p>这样，当收到证书错误时，忽略略掉，直接继续处理理就⾏行行了了;相当于信任了了所有的证书⼀一样。</p>
<p><strong>webview销毁问题</strong> 在某些⼿手机上，Webview有视频时，activity销毁后，视频资源没有被销毁，甚⾄至还 能听到在后台播放。即便便是像刚才那样各种销毁webview也⽆无济于事，解决办法:在onDestory之前修 改url为空地址。</p>
<p><strong>WebView硬件加速导致⻚页⾯面渲染闪烁问题</strong> 关于Android硬件加速 开始于Android 3.0 (API level 11),开 启硬件加速后，WebView渲染⻚页⾯面更更加快速，拖动也更更加顺滑。但有个副作⽤用就是容易易会出现⻚页⾯面加载 ⽩白块同时界⾯面闪烁现象。解决这个问题的⽅方法是设置WebView暂时关闭硬件加速 代码如下:</p>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"> 
<span class="k">if</span> <span class="o">(</span><span class="n">Build</span><span class="o">.</span><span class="na">VERSION</span><span class="o">.</span><span class="na">SDK_INT</span> <span class="o">&gt;=</span> <span class="n">Build</span><span class="o">.</span><span class="na">VERSION_CODES</span><span class="o">.</span><span class="na">HONEYCOMB</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">webview</span><span class="o">.</span><span class="na">setLayerType</span><span class="o">(</span><span class="n">View</span><span class="o">.</span><span class="na">LAYER_TYPE_SOFTWARE</span><span class="o">,</span> <span class="kc">null</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></div><p><strong>h5加载百度地图不不显示问题</strong> //启⽤用数据库 webSettings.setDatabaseEnabled(true); String dir = this.getApplicationContext().getDir(&ldquo;database&rdquo;, Context.MODE_PRIVATE).getPath(); //启⽤用地理理定位 webSettings.setGeolocationEnabled(true);</p>
</div><div class="post-footer" id="post-footer">
    <div class="post-info">
        <div class="post-info-line">
            <div class="post-info-mod">
                <span>更新于 2020-04-08</span>
            </div>
            <div class="post-info-license"></div>
        </div>
        <div class="post-info-line">
            <div class="post-info-md"></div>
            <div class="post-info-share">
                <span></span>
            </div>
        </div>
    </div>

    <div class="post-info-more">
        <section class="post-tags"><i class="fas fa-tags fa-fw"></i>&nbsp;<a href="/tags/android/">android</a></section>
        <section>
            <span><a href="javascript:void(0);" onclick="window.history.back();">返回</a></span>&nbsp;|&nbsp;<span><a href="/">主页</a></span>
        </section>
    </div>

    <div class="post-nav"><a href="/posts/android_%E5%9B%BE%E7%89%87%E5%8A%A0%E8%BD%BD/" class="prev" rel="prev" title="android图片加载框架"><i class="fas fa-angle-left fa-fw"></i>android图片加载框架</a>
            <a href="/posts/android_glide/" class="next" rel="next" title="android glide">android glide<i class="fas fa-angle-right fa-fw"></i></a></div>
</div>
<div id="comments"><div id="gitalk" class="comment"></div><noscript>
                Please enable JavaScript to view the comments powered by <a href="https://github.com/gitalk/gitalk"></a>Gitalk</a>.
            </noscript></div></article></div>
            </main><footer class="footer">
        <div class="footer-container"><div class="footer-line">由 <a href="https://gohugo.io/" target="_blank" rel="noopener noreffer" title="Hugo 0.74.3">Hugo</a> 强力驱动 | 主题 - <a href="https://github.com/dillonzq/LoveIt" target="_blank" rel="noopener noreffer" title="LoveIt 0.2.10"><i class="far fa-kiss-wink-heart fa-fw"></i> LoveIt</a>
                </div><div class="footer-line"><i class="far fa-copyright fa-fw"></i><span itemprop="copyrightYear">2020</span><span class="author" itemprop="copyrightHolder">&nbsp;<a href="https://xingliuhua/github.com.io" target="_blank">xingliuhua</a></span></div>
        </div>
    </footer></div>

        <div id="fixed-buttons"><a href="#" id="back-to-top" class="fixed-button" title="回到顶部">
                <i class="fas fa-arrow-up fa-fw"></i>
            </a><a href="#" id="view-comments" class="fixed-button" title="查看评论">
                <i class="fas fa-comment fa-fw"></i>
            </a>
        </div><link rel="stylesheet" href="/lib/gitalk/gitalk.min.css"><link rel="stylesheet" href="/lib/lightgallery/lightgallery.min.css"><script type="text/javascript" src="/lib/gitalk/gitalk.min.js"></script><script type="text/javascript" src="/lib/smooth-scroll/smooth-scroll.min.js"></script><script type="text/javascript" src="/lib/autocomplete/autocomplete.min.js"></script><script type="text/javascript" src="/lib/lunr/lunr.min.js"></script><script type="text/javascript" src="/lib/lunr/lunr.stemmer.support.min.js"></script><script type="text/javascript" src="/lib/lunr/lunr.zh.min.js"></script><script type="text/javascript" src="/lib/lazysizes/lazysizes.min.js"></script><script type="text/javascript" src="/lib/lightgallery/lightgallery.min.js"></script><script type="text/javascript" src="/lib/lightgallery/lg-thumbnail.min.js"></script><script type="text/javascript" src="/lib/lightgallery/lg-zoom.min.js"></script><script type="text/javascript" src="/lib/clipboard/clipboard.min.js"></script><script type="text/javascript">window.config={"code":{"copyTitle":"复制到剪贴板","maxShownLines":15},"comment":{"gitalk":{"admin":["xingliuhua"],"clientID":"c0161bf1d93ccdd5f765","clientSecret":"3782f9a39ee0849148faa2ec75bb19d9964dda16","id":"2020-04-08T17:55:28+08:00","owner":"xingliuhua","repo":"https://github.com/xingliuhua/xingliuhua.github.io","title":"android加载html"}},"lightGallery":{"actualSize":false,"exThumbImage":"data-thumbnail","hideBarsDelay":2000,"selector":".lightgallery","speed":400,"thumbContHeight":80,"thumbWidth":80,"thumbnail":true},"search":{"highlightTag":"em","lunrIndexURL":"/index.json","lunrLanguageCode":"zh","lunrSegmentitURL":"/lib/lunr/lunr.segmentit.js","maxResultLength":10,"noResultsFound":"没有找到结果","snippetLength":50,"type":"lunr"}};</script><script type="text/javascript" src="/js/theme.min.js"></script></body>
</html>
